<?xml version="1.0" encoding="UTF-8" ?>
<chapter xml:id="ch-fitting-models" xmlns:xi="http://www.w3.org/2001/XInclude">
  <title>Fitting Models to Data</title>

  <introduction>
    <p>
      One of the fundamental activities in statistics is creating models that can summarize data using a small set of numbers, thus providing a compact description of the data. In this chapter we will discuss the concept of a statistical model and how it can be used to describe data.
    </p>
  </introduction>

  <section xml:id="sec-what-is-model">
    <title>What is a model?</title>
    <p>
      In the physical world, <q>models</q> are generally simplifications of things in the real world that nonetheless convey the essence of the thing being modeled. A model of a building conveys the structure of the building while being small and light enough to pick up with one's hands; a model of a cell in biology is much larger than the actual thing, but again conveys the major parts of the cell and their relationships.
    </p>
    <p>
      In statistics, a model is meant to provide a similarly condensed description, but for data rather than for a physical structure. Like physical models, a statistical model is generally much simpler than the data being described; it is meant to capture the structure of the data as simply as possible. In both cases, we realize that the model is a convenient fiction that necessarily glosses over some of the details of the actual thing being modeled. As the statistician George Box famously said: <q>All models are wrong but some are useful.</q> It can also be useful to think of a statistical model as a theory of how the observed data were generated; our goal then becomes to find the model that most efficiently and accurately summarizes the way in which the data were actually generated. But as we will see below, the desires of efficiency and accuracy will often be diametrically opposed to one another.
    </p>
    <p>
      The basic structure of a statistical model is:
    </p>
    <me>
      data = model + error
    </me>
    <p>
      This expresses the idea that the data can be broken into two portions: one portion that is described by a statistical model, which expresses the values that we expect the data to take given our knowledge, and another portion that we refer to as the <em>error</em> that reflects the difference between the model's predictions and the observed data.
    </p>
    <p>
      In essence we would like to use our model to predict the value of the data for any given observation. We would write the equation like this:
    </p>
    <me>
      \widehat{data_i} = model_i
    </me>
    <p>
      The <q>hat</q> over the data denotes that it's our prediction rather than the actual value of the data. This means that the predicted value of the data for observation <m>i</m> is equal to the value of the model for that observation. Once we have a prediction from the model, we can then compute the error:
    </p>
    <me>
      error_i = data_i - \widehat{data_i}
    </me>
    <p>
      That is, the error for any observation is the difference between the observed value of the data and the predicted value of the data from the model.
    </p>
  </section>

  <section xml:id="sec-statistical-modeling-example">
    <title>Statistical modeling: An example</title>
    <p>
      Let's look at an example of building a model for data, using the data from NHANES. In particular, we will try to build a model of the height of children in the NHANES sample. First let's load the data and plot them (see <xref ref="fig-child-height"/>).
    </p>

    <program language="r">
      <input>
# Select children with good height measurements
NHANES_child &lt;- 
  NHANES %&gt;%
  drop_na(Height) %&gt;%
  subset(Age &lt; 18)

# Plot histogram of child heights
NHANES_child %&gt;% 
  ggplot(aes(Height)) + 
  geom_histogram(bins = 100)
      </input>
    </program>

    <figure xml:id="fig-child-height">
      <caption>Histogram of height of children in NHANES.</caption>
      <image source="childHeight.png" width="50%">
        <description>A histogram showing the distribution of heights for children in the NHANES dataset. The distribution appears roughly bell-shaped with heights ranging from about 75 to 200 cm.</description>
      </image>
    </figure>

    <p>
      Remember that we want to describe the data as simply as possible while still capturing their important features. The simplest model that we can imagine would involve only a single number; that is, the model would predict the same value for each observation, regardless of what else we might know about those observations. We generally describe a model in terms of its <em>parameters</em>, which are values that we can change in order to modify the predictions of the model. Throughout the book we will refer to these using the Greek letter beta (<m>\beta</m>); when the model has more than one parameter, we will use subscripted numbers to denote the different betas (e.g. <m>\beta_1</m>). It's also customary to refer to the values of the data using the letter <m>y</m>, and to use a subscripted version <m>y_i</m> to refer to the individual observations.
    </p>
    <p>
      We generally don't know the true values of the parameters, so we have to estimate them from the data. For this reason, we will generally put a <q>hat</q> over the <m>\beta</m> symbol to denote that we are using an estimate of the parameter value rather than its true value (which we generally don't know). Thus, our simple model for height using a single parameter would be:
    </p>
    <me>
      y_i = \beta + \epsilon
    </me>
    <p>
      The subscript <m>i</m> doesn't appear on the right side of the equation, which means that the prediction of the model doesn't depend on which observation we are looking at <mdash/> it's the same for all of them. Here <m>\epsilon</m> represents the error term for observation <m>i</m>. The question then becomes: how do we estimate the best values of the parameter(s) in the model? In this particular case, what single value is the best estimate for <m>\beta</m>? And, more importantly, how do we even define <em>best</em>?
    </p>
    <p>
      One very simple estimator that we might imagine is the <em>mode</em>, which is simply the most common value in the dataset. This redescribes the entire set of children in terms of a single number. If we wanted to predict the height of any new children, then our predicted value would be the same number:
    </p>
    <me>
      \hat{y_i} = 166.5
    </me>
    <p>
      The error for each individual would then be the difference between the predicted value (<m>\hat{y_i}</m>) and their actual height (<m>y_i</m>):
    </p>
    <me>
      error_i = y_i - \hat{y_i}
    </me>
    <p>
      How good of a model is this? In general we define the goodness of a model in terms of the magnitude of the error, which represents the degree to which the data diverge from the model's predictions; all things being equal, the model that produces lower error is the better model. (Though as we will see later, all things are usually not equal...) What we find in this case is that the average individual has a fairly large error when we use the mode as our estimator for <m>\beta</m>, which doesn't seem very good on its face.
    </p>
    <p>
      How might we find a better estimator for our model parameter? We might start by trying to find an estimator that gives us an average error of zero. One good candidate is the arithmetic mean (that is, the <em>average</em>, often denoted by a bar over the variable, such as <m>\bar{X}</m>), computed as the sum of all of the values divided by the number of values. Mathematically, we express this as:
    </p>
    <me>
      \bar{X} = \frac{\sum_{i=1}^{n}x_i}{n}
    </me>
    <p>
      It turns out that if we use the arithmetic mean as our estimator then the average error will indeed be zero (see the simple proof at the end of the chapter if you are interested). Even though the average of errors from the mean is zero, we can see from the histogram in <xref ref="fig-mean-error"/> that each individual still has some degree of error; some are positive and some are negative, and those cancel each other out to give an average error of zero.
    </p>

    <figure xml:id="fig-mean-error">
      <caption>Distribution of errors from the mean.</caption>
      <image source="meanError.png" width="50%">
        <description>A histogram showing the distribution of errors when predicting height with the mean. The distribution is centered at zero and ranges from about -60 to 60 cm.</description>
      </image>
    </figure>

    <p>
      The fact that the negative and positive errors cancel each other out means that two different models could have errors of very different magnitude in absolute terms, but would still have the same average error. This is exactly why the average error is not a good criterion for our estimator; we want a criterion that tries to minimize the overall error regardless of its direction. For this reason, we generally summarize errors in terms of some kind of measure that counts both positive and negative errors as bad. We could use the absolute value of each error value, but it's more common to use the squared errors, for reasons that we will see later in the book.
    </p>
    <p>
      There are several common ways to summarize the squared error that you will encounter at various points in this book, so it's important to understand how they relate to one another. First, we could simply add them up; this is referred to as the <em>sum of squared errors</em>. The reason we don't usually use this is that its magnitude depends on the number of data points, so it can be difficult to interpret unless we are looking at the same number of observations. Second, we could take the mean of the squared error values, which is referred to as the <em>mean squared error (MSE)</em>. However, because we squared the values before averaging, they are not on the same scale as the original data; they are in <m>centimeters^2</m>. For this reason, it's also common to take the square root of the MSE, which we refer to as the <em>root mean squared error (RMSE)</em>, so that the error is measured in the same units as the original values (in this example, centimeters).
    </p>
    <p>
      The mean has a pretty substantial amount of error <mdash/> any individual data point will be about 21 cm from the mean on average <mdash/> but it's still much better than the mode, which has a root mean squared error of about 28 cm.
    </p>

    <subsection xml:id="subsec-improving-model">
      <title>Improving our model</title>
      <p>
        Can we imagine a better model? Remember that these data are from all children in the NHANES sample, who vary from 2 to 17 years of age. Given this wide age range, we might expect that our model of height should also include age. Let's plot the data for height against age, to see if this relationship really exists.
      </p>

      <figure xml:id="fig-child-height-line">
        <caption>Height of children in NHANES, plotted without a model (A), with a linear model including only age (B) or age and a constant (C), and with a linear model that fits separate effects of age for males and females (D).</caption>
        <image source="childHeightLine.png" width="80%">
          <description>Four panels showing scatter plots of children's height vs age. Panel A shows raw data. Panel B shows data with a line through the origin. Panel C shows data with a fitted line with intercept. Panel D shows data with separate lines for males and females.</description>
        </image>
      </figure>

      <p>
        The black points in Panel A of <xref ref="fig-child-height-line"/> show individuals in the dataset, and there seems to be a strong relationship between height and age, as we would expect. Thus, we might build a model that relates height to age:
      </p>
      <me>
        \hat{y_i} = \hat{\beta} * age_i
      </me>
      <p>
        where <m>\hat{\beta}</m> is our estimate of the parameter that we multiply by age to generate the model prediction.
      </p>
      <p>
        You may remember from algebra that a line is defined as follows:
      </p>
      <me>
        y = slope*x + intercept
      </me>
      <p>
        If age is the <m>X</m> variable, then that means that our prediction of height from age will be a line with a slope of <m>\beta</m> and an intercept of zero - to see this, let's plot the best fitting line in blue on top of the data (Panel B in <xref ref="fig-child-height-line"/>). Something is clearly wrong with this model, as the line doesn't seem to follow the data very well. In fact, the RMSE for this model is actually higher than the model that only includes the mean! The problem comes from the fact that our model only includes age, which means that the predicted value of height from the model must take on a value of zero when age is zero. Even though the data do not include any children with an age of zero, the line is mathematically required to have a y-value of zero when x is zero, which explains why the line is pulled down below the younger datapoints. We can fix this by including an intercept in our model, which basically represents the estimated height when age is equal to zero; even though an age of zero is not plausible in this dataset, this is a mathematical trick that will allow the model to account for the overall magnitude of the data. The model is:
      </p>
      <me>
        \widehat{y_i} = \hat{\beta_0} + \hat{\beta_1} * age_i
      </me>
      <p>
        where <m>\hat{\beta_0}</m> is our estimate for the <em>intercept</em>, which is a constant value added to the prediction for each individual; we call it the intercept because it maps onto the intercept in the equation for a straight line. We will learn later how it is that we actually estimate these parameter values for a particular dataset; for now, we will use our statistical software to estimate the parameter values that give us the smallest error for these particular data. Panel C in <xref ref="fig-child-height-line"/> shows this model applied to the NHANES data, where we see that the line matches the data much better than the one without a constant.
      </p>
      <p>
        Our error is much smaller using this model <mdash/> only about 8 centimeters on average. Can you think of other variables that might also be related to height? What about gender? In Panel D of <xref ref="fig-child-height-line"/> we plot the data with lines fitted separately for males and females. From the plot, it seems that there is a difference between males and females, but it is relatively small and only emerges after the age of puberty. In <xref ref="fig-mse-plot"/> we plot the root mean squared error values across the different models, including one with an additional parameter that models the effect of gender. From this we see that the model got a little bit better going from mode to mean, much better going from mean to mean + age, and only very slightly better by including gender as well.
      </p>

      <figure xml:id="fig-mse-plot">
        <caption>Mean squared error plotted for each of the models tested above.</caption>
        <image source="msePlot.png" width="50%">
          <description>A horizontal bar chart showing root mean squared error for four models: mode (highest), mean, constant + age, and constant + age + gender (lowest).</description>
        </image>
      </figure>
    </subsection>
  </section>

  <section xml:id="sec-what-makes-model-good">
    <title>What makes a model "good"?</title>
    <p>
      There are generally two different things that we want from our statistical model. First, we want it to describe our data well; that is, we want it to have the lowest possible error when modeling our data. Second, we want it to generalize well to new datasets; that is, we want its error to be as low as possible when we apply it to a new dataset in order to make a prediction. It turns out that these two features can often be in conflict.
    </p>
    <p>
      To understand this, let's think about where error comes from. First, it can occur if our model is wrong; for example, if we inaccurately said that height goes down with age instead of going up, then our error will be higher than it would be for the correct model. Similarly, if there is an important factor that is missing from our model, that will also increase our error (as it did when we left age out of the model for height). However, error can also occur even when the model is correct, due to random variation in the data, which we often refer to as <q>measurement error</q> or <q>noise</q>. Sometimes this really is due to error in our measurement <mdash/> for example, when the measurements rely on a human, such as using a stopwatch to measure elapsed time in a footrace. In other cases, our measurement device is highly accurate (like a digital scale to measure body weight), but the thing being measured is affected by many different factors that cause it to be variable. If we knew all of these factors then we could build a more accurate model, but in reality that's rarely possible.
    </p>
    <p>
      Let's use an example to show this. Rather than using real data, we will generate some data for the example using a computer simulation (about which we will have more to say in a few chapters). Let's say that we want to understand the relationship between a person's blood alcohol content (BAC) and their reaction time on a simulated driving test. We can generate some simulated data and plot the relationship (see Panel A of <xref ref="fig-bac-rt"/>).
    </p>

    <figure xml:id="fig-bac-rt">
      <caption>Simulated relationship between blood alcohol content and reaction time on a driving test, with best-fitting linear model represented by the line. A: linear relationship with low measurement error. B: linear relationship with higher measurement error. C: Nonlinear relationship with low measurement error and (incorrect) linear model.</caption>
      <image source="BACrt.png" width="80%">
        <description>Three scatter plots showing different relationships between BAC and reaction time. Panel A shows a tight linear relationship. Panel B shows a linear relationship with more scatter. Panel C shows a curved relationship with a straight line poorly fitting it.</description>
      </image>
    </figure>

    <p>
      In this example, reaction time goes up systematically with blood alcohol content <mdash/> the line shows the best fitting model, and we can see that there is very little error, which is evident in the fact that all of the points are very close to the line.
    </p>
    <p>
      We could also imagine data that show the same linear relationship, but have much more error, as in Panel B of <xref ref="fig-bac-rt"/>. Here we see that there is still a systematic increase of reaction time with BAC, but it's much more variable across individuals.
    </p>
    <p>
      These were both examples where the relationship between the two variables appears to be linear, and the error reflects noise in our measurement. On the other hand, there are other situations where the relationship between the variables is not linear, and error will be increased because the model is not properly specified. Let's say that we are interested in the relationship between caffeine intake and performance on a test. The relation between stimulants like caffeine and test performance is often <em>nonlinear</em> - that is, it doesn't follow a straight line. This is because performance goes up with smaller amounts of caffeine (as the person becomes more alert), but then starts to decline with larger amounts (as the person becomes nervous and jittery). We can simulate data of this form, and then fit a linear model to the data (see Panel C of <xref ref="fig-bac-rt"/>). The blue line shows the straight line that best fits these data; clearly, there is a high degree of error. Although there is a very lawful relation between test performance and caffeine intake, it follows a curve rather than a straight line. The model that assumes a linear relationship has high error because it's the wrong model for these data.
    </p>
  </section>

  <section xml:id="sec-overfitting">
    <title>Can a model be too good?</title>
    <p>
      Error sounds like a bad thing, and usually we will prefer a model that has lower error over one that has higher error. However, we mentioned above that there is a tension between the ability of a model to accurately fit the current dataset and its ability to generalize to new datasets, and it turns out that the model with the lowest error often is much worse at generalizing to new datasets!
    </p>
    <p>
      To see this, let's once again generate some data so that we know the true relation between the variables. We will create two simulated datasets, which are generated in exactly the same way <mdash/> they just have different random noise added to them. That is, the equation for both of them is <m>y = \beta * X + \epsilon</m>; the only difference is that different random noise was used for <m>\epsilon</m> in each case.
    </p>

    <figure xml:id="fig-overfitting">
      <caption>An example of overfitting. Both datasets were generated using the same model, with different random noise added to generate each set. The left panel shows the data used to fit the model, with a simple linear fit in blue and a complex (8th order polynomial) fit in red. The root mean square error (RMSE) values for each model are shown in the figure; in this case, the complex model has a lower RMSE than the simple model. The right panel shows the second dataset, with the same model overlaid on it and the RMSE values computed using the model obtained from the first dataset. Here we see that the simpler model actually fits the new dataset better than the more complex model, which was overfitted to the first dataset.</caption>
      <image source="Overfitting.png" width="80%">
        <description>Two scatter plots side by side. The left shows original data with blue and red fitted lines. The right shows new data with the same lines overlaid. RMSE values indicate the simple model generalizes better.</description>
      </image>
    </figure>

    <p>
      The left panel in <xref ref="fig-overfitting"/> shows that the more complex model (in red) fits the data better than the simpler model (in blue). However, we see the opposite when the same model is applied to a new dataset generated in the same way <mdash/> here we see that the simpler model fits the new data better than the more complex model. Intuitively, we can see that the more complex model is influenced heavily by the specific data points in the first dataset; since the exact position of these data points was driven by random noise, this leads the more complex model to fit badly on the new dataset. This is a phenomenon that we call <em>overfitting</em>. For now it's simply important to keep in mind that our model fit needs to be good, but not too good. As Albert Einstein (1933) said: <q>It can scarcely be denied that the supreme goal of all theory is to make the irreducible basic elements as simple and as few as possible without having to surrender the adequate representation of a single datum of experience.</q> Which is often paraphrased as: <q>Everything should be as simple as it can be, but not simpler.</q>
    </p>
  </section>

  <section xml:id="sec-mean">
    <title>Summarizing data using the mean</title>
    <p>
      We have already encountered the mean (or average) above, and in fact most people know about the average even if they have never taken a statistics class. It is commonly used to describe what we call the <q>central tendency</q> of a dataset <mdash/> that is, what value are the data centered around? Most people don't think of computing a mean as fitting a model to data. However, that's exactly what we are doing when we compute the mean.
    </p>
    <p>
      We have already seen the formula for computing the mean of a sample of data:
    </p>
    <me>
      \bar{X} = \frac{\sum_{i=1}^{n}x_i}{n}
    </me>
    <p>
      Note that I said that this formula was specifically for a <em>sample</em> of data, which is a set of data points selected from a larger population. Using a sample, we wish to characterize a larger population <mdash/> the full set of individuals that we are interested in. For example, if we are a political pollster our population of interest might be all registered voters, whereas our sample might just include a few thousand people sampled from this population. In Chapter 7 we will talk in more detail about sampling, but for now the important point is that statisticians generally like to use different symbols to differentiate <em>statistics</em> that describe values for a sample from <em>parameters</em> that describe the true values for a population; in this case, the formula for the population mean (denoted as <m>\mu</m>) is:
    </p>
    <me>
      \mu = \frac{\sum_{i=1}^{N}x_i}{N}
    </me>
    <p>
      where N is the size of the entire population.
    </p>
    <p>
      We have already seen that the mean is the estimator that is guaranteed to give us an average error of zero, but we also learned that the average error is not the best criterion; instead, we want an estimator that gives us the lowest sum of squared errors (SSE), which the mean also does. We could prove this using calculus, but instead we will demonstrate it graphically in <xref ref="fig-min-sse"/>.
    </p>

    <figure xml:id="fig-min-sse">
      <caption>A demonstration of the mean as the statistic that minimizes the sum of squared errors. Using the NHANES child height data, we compute the mean (denoted by the blue bar). Then, we test a range of possible parameter estimates, and for each one we compute the sum of squared errors for each data point from that value, which are denoted by the black curve. We see that the mean falls at the minimum of the squared error plot.</caption>
      <image source="MinSSE.png" width="50%">
        <description>A plot showing sum of squared errors on the y-axis versus test value on the x-axis. A blue vertical line marks the mean, which aligns with the minimum of the curve.</description>
      </image>
    </figure>

    <p>
      This minimization of SSE is a good feature, and it's why the mean is the most commonly used statistic to summarize data. However, the mean also has a dark side. Let's say that five people are in a bar, and we examine each person's income:
    </p>

    <table xml:id="table-income1">
      <title>Income for our five bar patrons</title>
      <tabular>
        <row header="yes">
          <cell>Person</cell>
          <cell>Income</cell>
        </row>
        <row>
          <cell>Joe</cell>
          <cell>48,000</cell>
        </row>
        <row>
          <cell>Karen</cell>
          <cell>64,000</cell>
        </row>
        <row>
          <cell>Mark</cell>
          <cell>58,000</cell>
        </row>
        <row>
          <cell>Andrea</cell>
          <cell>72,000</cell>
        </row>
        <row>
          <cell>Pat</cell>
          <cell>66,000</cell>
        </row>
      </tabular>
    </table>

    <p>
      The mean ($61,600) seems to be a pretty good summary of the income of those five people. Now let's look at what happens if Beyoncé Knowles walks into the bar:
    </p>

    <table xml:id="table-income2">
      <title>Income for our five bar patrons plus Beyoncé Knowles</title>
      <tabular>
        <row header="yes">
          <cell>Person</cell>
          <cell>Income</cell>
        </row>
        <row>
          <cell>Joe</cell>
          <cell>48,000</cell>
        </row>
        <row>
          <cell>Karen</cell>
          <cell>64,000</cell>
        </row>
        <row>
          <cell>Mark</cell>
          <cell>58,000</cell>
        </row>
        <row>
          <cell>Andrea</cell>
          <cell>72,000</cell>
        </row>
        <row>
          <cell>Pat</cell>
          <cell>66,000</cell>
        </row>
        <row>
          <cell>Beyoncé</cell>
          <cell>54,000,000</cell>
        </row>
      </tabular>
    </table>

    <p>
      The mean is now almost $10 million, which is not really representative of any of the people in the bar <mdash/> in particular, it is heavily driven by the outlying value of Beyoncé. In general, the mean is highly sensitive to extreme values, which is why it's always important to ensure that there are no extreme values when using the mean to summarize data.
    </p>

    <subsection xml:id="subsec-median">
      <title>Summarizing data robustly using the median</title>
      <p>
        If we want to summarize the data in a way that is less sensitive to outliers, we can use another statistic called the <em>median</em>. If we were to sort all of the values in order of their magnitude, then the median is the value in the middle. If there is an even number of values then there will be two values tied for the middle place, in which case we take the mean (i.e. the halfway point) of those two numbers.
      </p>
      <p>
        Let's look at an example. Say we want to summarize the following values:
      </p>
      <p>
        8 6 3 14 12 7 6 4 9
      </p>
      <p>
        If we sort those values:
      </p>
      <p>
        3 4 6 6 7 8 9 12 14
      </p>
      <p>
        Then the median is the middle value <mdash/> in this case, the 5th of the 9 values.
      </p>
      <p>
        Whereas the mean minimizes the sum of squared errors, the median minimizes a slightly different quantity: The sum of the <em>absolute value</em> of errors. This explains why it is less sensitive to outliers <mdash/> squaring is going to exacerbate the effect of large errors compared to taking the absolute value. We can see this in the case of the income example: The median income ($65,000) is much more representative of the group as a whole than the mean ($9,051,333), and less sensitive to the one large outlier.
      </p>
      <p>
        Given this, why would we ever use the mean? As we will see in a later chapter, the mean is the <q>best</q> estimator in the sense that it will vary less from sample to sample compared to other estimators. It's up to us to decide whether that is worth the sensitivity to potential outliers <mdash/> statistics is all about tradeoffs.
      </p>
    </subsection>
  </section>

  <section xml:id="sec-mode">
    <title>The mode</title>
    <p>
      Sometimes we wish to describe the central tendency of a dataset that is not numeric. For example, let's say that we want to know which models of iPhone are most commonly used. To test this, we could ask a large group of iPhone users which model each person owns. If we were to take the average of these values, we might see that the mean iPhone model is some value like 9.6, which is clearly nonsensical, since the iPhone model numbers are not meant to be quantitative measurements. In this case, a more appropriate measure of central tendency is the mode, which is the most common value in the dataset, as we discussed above.
    </p>
  </section>

  <section xml:id="sec-variability">
    <title>Variability: How well does the mean fit the data?</title>
    <p>
      Once we have described the central tendency of the data, we often also want to describe how variable the data are <mdash/> this is sometimes also referred to as <q>dispersion</q>, reflecting the fact that it describes how widely dispersed the data are.
    </p>
    <p>
      We have already encountered the sum of squared errors above, which is the basis for the most commonly used measures of variability: the <em>variance</em> and the <em>standard deviation</em>. The variance for a population (referred to as <m>\sigma^2</m>) is simply the sum of squared errors divided by the number of observations - that is, it is exactly the same as the <em>mean squared error</em> that you encountered earlier:
    </p>
    <me>
      \sigma^2 = \frac{SSE}{N} = \frac{\sum_{i=1}^n (x_i - \mu)^2}{N}
    </me>
    <p>
      where <m>\mu</m> is the population mean. The population standard deviation is simply the square root of this <mdash/> that is, the <em>root mean squared error</em> that we saw before. The standard deviation is useful because the errors are in the same units as the original data (undoing the squaring that we applied to the errors).
    </p>
    <p>
      We usually don't have access to the entire population, so we have to compute the variance using a sample, which we refer to as <m>\hat{\sigma}^2</m>, with the <q>hat</q> representing the fact that this is an estimate based on a sample. The equation for <m>\hat{\sigma}^2</m> is similar to the one for <m>\sigma^2</m>:
    </p>
    <me>
      \hat{\sigma}^2 = \frac{\sum_{i=1}^n (x_i - \bar{X})^2}{n-1}
    </me>
    <p>
      The only difference between the two equations is that we divide by n - 1 instead of N. This relates to a fundamental statistical concept: <em>degrees of freedom</em>. Remember that in order to compute the sample variance, we first had to estimate the sample mean <m>\bar{X}</m>. Having estimated this, one value in the data is no longer free to vary. For example, let's say we have the following data points for a variable <m>x</m>: [3, 5, 7, 9, 11], the mean of which is 7. Because we know that the mean of this dataset is 7, we can compute what any specific value would be if it were missing. For example, let's say we were to obscure the first value (3). Having done this, we still know that its value must be 3, because the mean of 7 implies that the sum of all of the values is <m>7 * n = 35</m> and <m>35 - (5 + 7 + 9 + 11) = 3</m>.
    </p>
    <p>
      So when we say that we have <q>lost</q> a degree of freedom, it means that there is a value that is not free to vary after fitting the model. In the context of the sample variance, if we don't account for the lost degree of freedom, then our estimate of the sample variance will be <em>biased</em>, causing us to underestimate the uncertainty of our estimate of the mean.
    </p>
  </section>

  <section xml:id="sec-simulations">
    <title>Using simulations to understand statistics</title>
    <p>
      I am a strong believer in the use of computer simulations to understand statistical concepts, and in later chapters we will dig more deeply into their use. Here we will introduce the idea by asking whether we can confirm the need to subtract 1 from the sample size in computing the sample variance.
    </p>
    <p>
      Let's treat the entire sample of children from the NHANES data as our <q>population</q>, and see how well the calculations of sample variance using either <m>n</m> or <m>n-1</m> in the denominator will estimate variance of this population, across a large number of simulated random samples from the data. We will return to the details of how to do this in a later chapter.
    </p>

    <table xml:id="table-varsim">
      <title>Variance estimates using n versus n-1; the estimate using n-1 is closer to the population value</title>
      <tabular>
        <row header="yes">
          <cell>Estimate</cell>
          <cell>Value</cell>
        </row>
        <row>
          <cell>Population variance</cell>
          <cell>277.5</cell>
        </row>
        <row>
          <cell>Variance estimate using n</cell>
          <cell>271.9</cell>
        </row>
        <row>
          <cell>Variance estimate using n-1</cell>
          <cell>277.5</cell>
        </row>
      </tabular>
    </table>

    <p>
      The results in <xref ref="table-varsim"/> show us that the theory outlined above was correct: The variance estimate using <m>n - 1</m> as the denominator is very close to the variance computed on the full data (i.e, the population), whereas the variance computed using <m>n</m> as the denominator is biased (smaller) compared to the true value.
    </p>
  </section>

  <section xml:id="sec-z-scores">
    <title>Z-scores</title>
    <p>
      Having characterized a distribution in terms of its central tendency and variability, it is often useful to express the individual scores in terms of where they sit with respect to the overall distribution. Let's say that we are interested in characterizing the relative level of crimes across different states, in order to determine whether California is a particularly dangerous place. We can ask this question using data for 2014 from the FBI's Uniform Crime Reporting site. The left panel of <xref ref="fig-crime-hist"/> shows a histogram of the number of violent crimes per state, highlighting the value for California. Looking at these data, it seems like California is terribly dangerous, with a large number of crimes in that year. We can visualize these data by generating a map showing the distribution of a variable across states, which is presented in the right panel of <xref ref="fig-crime-hist"/>.
    </p>

    <figure xml:id="fig-crime-hist">
      <caption>Left: Histogram of the number of violent crimes. The value for CA is plotted in blue. Right: A map of the same data, with number of crimes (in thousands) plotted for each state in color.</caption>
      <image source="crimeHist.png" width="80%">
        <description>Left panel shows a histogram with California marked in blue as an outlier. Right panel shows a US map with states colored by crime levels.</description>
      </image>
    </figure>

    <p>
      It may have occurred to you, however, that CA also has the largest population of any state in the US, so it's reasonable that it will also have a larger number of crimes. If we plot the number of crimes against one the population of each state (see left panel of <xref ref="fig-pop-vs-crime"/>), we see that there is a direct relationship between two variables.
    </p>

    <figure xml:id="fig-pop-vs-crime">
      <caption>Left: A plot of number of violent crimes versus population by state. Right: A histogram of per capita violent crime rates, expressed as crimes per 100,000 people.</caption>
      <image source="popVsCrime.png" width="80%">
        <description>Left panel shows scatter plot of crimes vs population with California marked. Right panel shows histogram of crime rates with California marked.</description>
      </image>
    </figure>

    <p>
      Instead of using the raw numbers of crimes, we should instead use the violent crime <em>rate</em> per capita, which we obtain by dividing the number of crimes per state by the population of each state. The dataset from the FBI already includes this value (expressed as rate per 100,000 people). Looking at the right panel of <xref ref="fig-pop-vs-crime"/>, we see that California is not so dangerous after all <mdash/> its crime rate is a bit above the mean across states, but well within the range of many other states. But what if we want to get a clearer view of how far it is from the rest of the distribution?
    </p>
    <p>
      The <em>Z-score</em> allows us to express data in a way that provides more insight into each data point's relationship to the overall distribution. The formula to compute a Z-score for an individual data point given that we know the value of the population mean <m>\mu</m> and standard deviation <m>\sigma</m> is:
    </p>
    <me>
      Z(x) = \frac{x - \mu}{\sigma}
    </me>
    <p>
      Intuitively, you can think of a Z-score as telling you how far away any data point is from the mean, in units of standard deviation. We can compute this for the crime rate data, as shown in <xref ref="fig-crime-z-plot"/>, which plots the Z-scores against the original scores.
    </p>

    <figure xml:id="fig-crime-z-plot">
      <caption>Scatterplot of original crime rate data against Z-scored data.</caption>
      <image source="crimeZplot.png" width="50%">
        <description>A scatter plot showing a perfect linear relationship between original crime rates and Z-scored crime rates.</description>
      </image>
    </figure>

    <p>
      The scatterplot shows us that the process of Z-scoring doesn't change the relative distribution of the data points (visible in the fact that the original data and Z-scored data fall on a straight line when plotted against each other) <mdash/> it just shifts them to have a mean of zero and a standard deviation of one. <xref ref="fig-crime-z-map"/> shows the Z-scored crime data using the geographical view.
    </p>

    <figure xml:id="fig-crime-z-map">
      <caption>Crime data rendered onto a US map, presented as Z-scores.</caption>
      <image source="crimeZmap.png" width="60%">
        <description>A US map with states colored according to Z-scored crime rates, showing which states are above or below the mean.</description>
      </image>
    </figure>

    <p>
      This provides us with a slightly more interpretable view of the data. For example, we can see that Nevada, Tennessee, and New Mexico all have crime rates that are roughly two standard deviations above the mean.
    </p>

    <subsection xml:id="subsec-interpreting-z-scores">
      <title>Interpreting Z-scores</title>
      <p>
        The <q>Z</q> in <q>Z-score</q> comes from the fact that the standard normal distribution (that is, a normal distribution with a mean of zero and a standard deviation of 1) is often referred to as the <q>Z</q> distribution. We can use the standard normal distribution to help us understand what specific Z scores tell us about where a data point sits with respect to the rest of the distribution.
      </p>

      <figure xml:id="fig-z-density-cdf">
        <caption>Density (top) and cumulative distribution (bottom) of a standard normal distribution, with cutoffs at one standard deviation above/below the mean.</caption>
        <image source="zDensityCDF.png" width="60%">
          <description>Two panels showing the density and cumulative distribution function of a standard normal distribution with shaded regions at +/- 1 standard deviation.</description>
        </image>
      </figure>

      <p>
        The upper panel in <xref ref="fig-z-density-cdf"/> shows that we expect about 16% of values to fall in <m>Z\ge 1</m>, and the same proportion to fall in <m>Z\le -1</m>.
      </p>

      <figure xml:id="fig-z-density-2sd">
        <caption>Density (top) and cumulative distribution (bottom) of a standard normal distribution, with cutoffs at two standard deviations above/below the mean.</caption>
        <image source="zDensity2SD.png" width="60%">
          <description>Two panels showing the density and cumulative distribution function of a standard normal distribution with shaded regions at +/- 2 standard deviations.</description>
        </image>
      </figure>

      <p>
        <xref ref="fig-z-density-2sd"/> shows the same plot for two standard deviations. Here we see that only about 2.3% of values fall in <m>Z \le -2</m> and the same in <m>Z \ge 2</m>. Thus, if we know the Z-score for a particular data point, we can estimate how likely or unlikely we would be to find a value at least as extreme as that value, which lets us put values into better context. In the case of crime rates, we see that California has a Z-score of 0.38 for its violent crime rate per capita, showing that it is quite near the mean of other states, with about 35% of states having higher rates and 65% of states having lower rates.
      </p>
    </subsection>

    <subsection xml:id="subsec-standardized-scores">
      <title>Standardized scores</title>
      <p>
        Let's say that instead of Z-scores, we wanted to generate standardized crime scores with a mean of 100 and standard deviation of 10. This is similar to the standardization that is done with scores from intelligence tests to generate the intelligence quotient (IQ). We can do this by simply multiplying the Z-scores by 10 and then adding 100.
      </p>

      <figure xml:id="fig-std-scores">
        <caption>Crime data presented as standardized scores with mean of 100 and standard deviation of 10.</caption>
        <image source="stdScores.png" width="50%">
          <description>A histogram of standardized crime scores with California marked, showing the distribution centered at 100.</description>
        </image>
      </figure>
    </subsection>

    <subsection xml:id="subsec-z-scores-compare">
      <title>Using Z-scores to compare distributions</title>
      <p>
        One useful application of Z-scores is to compare distributions of different variables. Let's say that we want to compare the distributions of violent crimes and property crimes across states. In the left panel of <xref ref="fig-crime-type-plot"/> we plot those against one another, with CA plotted in blue. As you can see, the raw rates of property crimes are far higher than the raw rates of violent crimes, so we can't just compare the numbers directly. However, we can plot the Z-scores for these data against one another (right panel of <xref ref="fig-crime-type-plot"/>) <mdash/> here again we see that the distribution of the data does not change. Having put the data into Z-scores for each variable makes them comparable, and lets us see that California is actually right in the middle of the distribution in terms of both violent crime and property crime.
      </p>

      <figure xml:id="fig-crime-type-plot">
        <caption>Plot of violent vs. property crime rates (left) and Z-scored rates (right).</caption>
        <image source="crimeTypePlot.png" width="80%">
          <description>Two scatter plots comparing violent and property crime rates. Left shows raw rates, right shows Z-scored rates with California marked in blue.</description>
        </image>
      </figure>

      <p>
        Let's add one more factor to the plot: Population. In the left panel of <xref ref="fig-crime-type-pop-plot"/> we show this using the size of the plotting symbol, which is often a useful way to add information to a plot.
      </p>

      <figure xml:id="fig-crime-type-pop-plot">
        <caption>Left: Plot of violent vs. property crime rates, with population size presented through the size of the plotting symbol; California is presented in blue. Right: Difference scores for violent vs. property crime, plotted against population.</caption>
        <image source="crimeTypePopPlot.png" width="80%">
          <description>Two panels: left shows Z-scored crime rates with bubble sizes for population, right shows difference scores vs population.</description>
        </image>
      </figure>

      <p>
        Because Z-scores are directly comparable, we can also compute a <em>difference score</em> that expresses the relative rate of violent to non-violent (property) crimes across states. We can then plot those scores against population (see right panel of <xref ref="fig-crime-type-pop-plot"/>). This shows how we can use Z-scores to bring different variables together on a common scale.
      </p>
      <p>
        It is worth noting that the smallest states appear to have the largest differences in both directions. While it might be tempting to look at each state and try to determine why it has a high or low difference score, this probably reflects the fact that the estimates obtained from smaller samples are necessarily going to be more variable, as we will discuss in Chapter 7.
      </p>
    </subsection>
  </section>

  <section xml:id="sec-fitting-models-learning-objectives">
    <title>Learning objectives</title>
    <p>
      Having read this chapter, you should be able to:
    </p>
    <ul>
      <li>Describe the basic equation for statistical models (data=model + error)</li>
      <li>Describe different measures of central tendency and dispersion, how they are computed, and which are appropriate under what circumstances.</li>
      <li>Compute a Z-score and describe why they are useful.</li>
    </ul>
  </section>

  <section xml:id="sec-fitting-models-appendix">
    <title>Appendix</title>

    <subsection xml:id="subsec-proof-mean-errors-zero">
      <title>Proof that the sum of errors from the Mean is zero</title>
      <me>
        error = \sum_{i=1}^{n}(x_i - \bar{X}) = 0
      </me>
      <me>
        \sum_{i=1}^{n}x_i - \sum_{i=1}^{n}\bar{X}=0
      </me>
      <me>
        \sum_{i=1}^{n}x_i = \sum_{i=1}^{n}\bar{X}
      </me>
      <me>
        \sum_{i=1}^{n}x_i = n\bar{X}
      </me>
      <me>
        \sum_{i=1}^{n}x_i = \sum_{i=1}^{n}x_i
      </me>
    </subsection>
  </section>

</chapter>
